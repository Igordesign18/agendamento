<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Barbearia Yuri Kelven</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --dark-bg: #0a0a0a;
            --dark-card: #1a1a1a;
            --lime: #c4ff0d;
            --lime-dark: #9fcc0a;
            --text: #ffffff;
            --text-muted: #888888;
            --red: #ff4444;
            --orange: #ff9800;
            --green: #4caf50;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--dark-bg);
            color: var(--text);
            min-height: 100vh;
        }

        /* Header */
        header {
            background: var(--dark-card);
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(196, 255, 13, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .barber-photo {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid var(--lime);
            background: var(--dark-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--lime);
        }

        .barber-photo img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        .logo h1 {
            font-size: 24px;
            color: var(--lime);
        }

        .admin-badge {
            background: var(--lime);
            color: var(--dark-bg);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        .logout-btn {
            background: transparent;
            border: 2px solid var(--lime);
            color: var(--lime);
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: var(--lime);
            color: var(--dark-bg);
        }

        /* Login Screen */
        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-card {
            background: var(--dark-card);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 5px 30px rgba(196, 255, 13, 0.2);
            width: 100%;
            max-width: 400px;
        }

        .login-card h2 {
            text-align: center;
            margin-bottom: 10px;
            color: var(--lime);
        }

        .login-card p {
            text-align: center;
            color: var(--text-muted);
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-muted);
            font-size: 14px;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            background: var(--dark-bg);
            border: 2px solid #333;
            border-radius: 5px;
            color: var(--text);
            font-size: 16px;
            transition: border 0.3s;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--lime);
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: var(--lime);
            color: var(--dark-bg);
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn:hover {
            background: var(--lime-dark);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--dark-bg);
            color: var(--lime);
            border: 2px solid var(--lime);
        }

        .btn-danger {
            background: var(--red);
            color: white;
        }

        /* Main Content */
        .main-content {
            display: none;
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--dark-card);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 3px 20px rgba(0, 0, 0, 0.3);
            border-left: 4px solid var(--lime);
        }

        .stat-card h3 {
            color: var(--text-muted);
            font-size: 14px;
            margin-bottom: 10px;
        }

        .stat-card .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: var(--lime);
        }

        .stat-card .stat-icon {
            float: right;
            font-size: 40px;
            color: var(--lime);
            opacity: 0.3;
        }

        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .card {
            background: var(--dark-card);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 3px 20px rgba(0, 0, 0, 0.3);
        }

        .card h2 {
            color: var(--lime);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 20px;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #333;
        }

        .tab {
            padding: 10px 20px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            color: var(--lime);
            border-bottom-color: var(--lime);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Bookings Table */
        .bookings-table {
            width: 100%;
            margin-top: 20px;
        }

        .booking-item {
            background: var(--dark-bg);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid var(--lime);
        }

        .booking-info h4 {
            margin-bottom: 5px;
        }

        .booking-info p {
            color: var(--text-muted);
            font-size: 14px;
            margin-top: 5px;
        }

        .booking-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-confirmed {
            background: var(--green);
            color: white;
        }

        .status-cancelled {
            background: var(--red);
            color: white;
        }

        .status-completed {
            background: var(--text-muted);
            color: white;
        }

        .booking-actions {
            display: flex;
            gap: 10px;
        }

        .booking-actions button {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-cancel {
            background: var(--red);
            color: white;
        }

        .btn-complete {
            background: var(--green);
            color: white;
        }

        /* Services List */
        .services-list {
            margin-top: 20px;
        }

        .service-item {
            background: var(--dark-bg);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .service-info h4 {
            margin-bottom: 5px;
        }

        .service-info p {
            color: var(--text-muted);
            font-size: 14px;
        }

        .service-actions {
            display: flex;
            gap: 10px;
        }

        .service-actions button {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-edit {
            background: var(--lime);
            color: var(--dark-bg);
        }

        .btn-delete {
            background: var(--red);
            color: white;
        }

        .day-schedule {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .day-item {
            background: var(--dark-bg);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            border: 2px solid #333;
            transition: all 0.3s;
        }

        .day-item:hover {
            border-color: var(--lime);
        }

        .day-item.active {
            background: rgba(196, 255, 13, 0.2);
            border-color: var(--lime);
        }

        .day-item h4 {
            color: var(--lime);
            margin-bottom: 5px;
        }

        .filter-section {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-section select, .filter-section input {
            flex: 1;
            min-width: 200px;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.3;
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 1024px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .day-schedule {
                grid-template-columns: repeat(4, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="header-content">
            <div class="logo">
                <div class="barber-photo">
                    <i class="fas fa-user"></i>
                </div>
                <div>
                    <h1>Yuri Kelven <span class="admin-badge">ADMIN</span></h1>
                    <p style="color: var(--text-muted); font-size: 14px;">Painel Administrativo</p>
                </div>
            </div>
            <button class="logout-btn hidden" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Sair
            </button>
        </div>
    </header>

    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-card">
            <h2><i class="fas fa-lock"></i> Acesso Admin</h2>
            <p>Entre com suas credenciais de administrador</p>
            <form id="loginForm">
                <div class="form-group">
                    <label for="adminEmail">Email</label>
                    <input type="email" id="adminEmail" required placeholder="admin@barbearia.com">
                </div>
                <div class="form-group">
                    <label for="adminPassword">Senha</label>
                    <input type="password" id="adminPassword" required placeholder="••••••••">
                </div>
                <button type="submit" class="btn">
                    <i class="fas fa-sign-in-alt"></i> Entrar
                </button>
            </form>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <i class="fas fa-calendar-check stat-icon"></i>
                <h3>Agendamentos Hoje</h3>
                <div class="stat-value" id="todayBookings">0</div>
            </div>
            <div class="stat-card">
                <i class="fas fa-clock stat-icon"></i>
                <h3>Próximos 7 Dias</h3>
                <div class="stat-value" id="weekBookings">0</div>
            </div>
            <div class="stat-card">
                <i class="fas fa-dollar-sign stat-icon"></i>
                <h3>Faturamento Mensal</h3>
                <div class="stat-value" id="monthRevenue">R$ 0</div>
            </div>
            <div class="stat-card">
                <i class="fas fa-users stat-icon"></i>
                <h3>Total Clientes</h3>
                <div class="stat-value" id="totalClients">0</div>
            </div>
        </div>

        <!-- Content Grid -->
        <div class="content-grid">
            <!-- Agendamentos -->
            <div class="card full-width">
                <h2><i class="fas fa-calendar-alt"></i> Gerenciar Agendamentos</h2>
                
                <div class="filter-section">
                    <select id="filterStatus">
                        <option value="all">Todos os Status</option>
                        <option value="confirmed">Confirmados</option>
                        <option value="completed">Concluídos</option>
                        <option value="cancelled">Cancelados</option>
                    </select>
                    <input type="date" id="filterDate">
                    <button class="btn btn-secondary" onclick="loadBookings()">
                        <i class="fas fa-search"></i> Filtrar
                    </button>
                </div>

                <div class="bookings-table" id="bookingsTable">
                    <div class="empty-state">
                        <i class="fas fa-calendar"></i>
                        <p>Carregando agendamentos...</p>
                    </div>
                </div>
            </div>

            <!-- Serviços -->
            <div class="card">
                <h2><i class="fas fa-cut"></i> Gerenciar Serviços</h2>
                
                <div class="form-group">
                    <label>Nome do Serviço</label>
                    <input type="text" id="serviceName" placeholder="Ex: Corte + Barba">
                </div>
                <div class="form-group">
                    <label>Preço (R$)</label>
                    <input type="number" id="servicePrice" placeholder="25.00" step="0.01">
                </div>
                <div class="form-group">
                    <label>Duração (minutos)</label>
                    <input type="number" id="serviceDuration" placeholder="40">
                </div>
                <button class="btn" onclick="addService()">
                    <i class="fas fa-plus"></i> Adicionar Serviço
                </button>

                <div class="services-list" id="servicesList"></div>
            </div>

            <!-- Horários -->
            <div class="card">
                <h2><i class="fas fa-clock"></i> Horários Disponíveis</h2>
                
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('schedule')">
                        <i class="fas fa-calendar-week"></i> Dias de Funcionamento
                    </button>
                    <button class="tab" onclick="switchTab('hours')">
                        <i class="fas fa-business-time"></i> Horários
                    </button>
                </div>

                <div class="tab-content active" id="scheduleTab">
                    <p style="color: var(--text-muted); margin-bottom: 15px;">
                        Selecione os dias que a barbearia funciona
                    </p>
                    <div class="day-schedule">
                        <div class="day-item active" data-day="0">
                            <h4>DOM</h4>
                            <p style="color: var(--text-muted); font-size: 12px;">Domingo</p>
                        </div>
                        <div class="day-item active" data-day="1">
                            <h4>SEG</h4>
                            <p style="color: var(--text-muted); font-size: 12px;">Segunda</p>
                        </div>
                        <div class="day-item active" data-day="2">
                            <h4>TER</h4>
                            <p style="color: var(--text-muted); font-size: 12px;">Terça</p>
                        </div>
                        <div class="day-item active" data-day="3">
                            <h4>QUA</h4>
                            <p style="color: var(--text-muted); font-size: 12px;">Quarta</p>
                        </div>
                        <div class="day-item active" data-day="4">
                            <h4>QUI</h4>
                            <p style="color: var(--text-muted); font-size: 12px;">Quinta</p>
                        </div>
                        <div class="day-item active" data-day="5">
                            <h4>SEX</h4>
                            <p style="color: var(--text-muted); font-size: 12px;">Sexta</p>
                        </div>
                        <div class="day-item active" data-day="6">
                            <h4>SÁB</h4>
                            <p style="color: var(--text-muted); font-size: 12px;">Sábado</p>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="hoursTab">
                    <div class="form-group">
                        <label>Horário de Abertura</label>
                        <input type="time" id="openTime" value="09:00">
                    </div>
                    <div class="form-group">
                        <label>Horário de Fechamento</label>
                        <input type="time" id="closeTime" value="18:00">
                    </div>
                    <div class="form-group">
                        <label>Intervalo entre atendimentos (minutos)</label>
                        <input type="number" id="intervalTime" value="30" min="15" step="15">
                    </div>
                    <button class="btn" onclick="saveSchedule()">
                        <i class="fas fa-save"></i> Salvar Configurações
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://syrlmjrbecidbpvofiqa.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN5cmxtanJiZWNpZGJwdm9maXFhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAyMzE0NDQsImV4cCI6MjA3NTgwNzQ0NH0.80whwN7m1YbwuZ8WLzek-ctWd9KNn97EwUQRzOMAnak';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let currentAdmin = null;
        let workingDays = [0, 1, 2, 3, 4, 5, 6];

        // Login
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;

            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });

                if (error) throw error;

                currentAdmin = data.user;
                showAdminPanel();
            } catch (error) {
                alert('Erro ao fazer login: ' + error.message);
            }
        });

        function showAdminPanel() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainContent').style.display = 'block';
            document.querySelector('.logout-btn').classList.remove('hidden');
            loadDashboard();
        }

        function logout() {
            supabase.auth.signOut();
            currentAdmin = null;
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('mainContent').style.display = 'none';
            document.querySelector('.logout-btn').classList.add('hidden');
        }

        // Load Dashboard
        async function loadDashboard() {
            await Promise.all([
                loadStats(),
                loadBookings(),
                loadServices(),
                loadScheduleSettings()
            ]);
        }

        // Load Stats
        async function loadStats() {
            try {
                const today = new Date().toISOString().split('T')[0];
                const weekLater = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                const monthStart = new Date(new Date().getFullYear(), new Date().getMonth(), 1).toISOString().split('T')[0];

                const { data: todayData } = await supabase
                    .from('bookings')
                    .select('*')
                    .eq('booking_date', today)
                    .eq('status', 'confirmed');

                document.getElementById('todayBookings').textContent = todayData?.length || 0;

                const { data: weekData } = await supabase
                    .from('bookings')
                    .select('*')
                    .gte('booking_date', today)
                    .lte('booking_date', weekLater)
                    .eq('status', 'confirmed');

                document.getElementById('weekBookings').textContent = weekData?.length || 0;

                const { data: monthData } = await supabase
                    .from('bookings')
                    .select('*, services(price)')
                    .gte('booking_date', monthStart)
                    .in('status', ['confirmed', 'completed']);

                const revenue = monthData?.reduce((sum, booking) => sum + (booking.services?.price || 0), 0) || 0;
                document.getElementById('monthRevenue').textContent = `R$ ${revenue.toFixed(2)}`;

                const { data: clientsData } = await supabase
                    .from('users')
                    .select('id');

                document.getElementById('totalClients').textContent = clientsData?.length || 0;
            } catch (error) {
                console.error('Erro ao carregar estatísticas:', error);
            }
        }

        // Load Bookings
        async function loadBookings() {
            try {
                const filterStatus = document.getElementById('filterStatus').value;
                const filterDate = document.getElementById('filterDate').value;

                let query = supabase
                    .from('bookings')
                    .select('*, users(full_name, phone, email), services(name, price, duration)')
                    .order('booking_date', { ascending: true })
                    .order('booking_time', { ascending: true });

                if (filterStatus !== 'all') {
                    query = query.eq('status', filterStatus);
                }

                if (filterDate) {
                    query = query.eq('booking_date', filterDate);
                }

                const { data, error } = await query;

                if (error) throw error;

                const container = document.getElementById('bookingsTable');

                if (!data || data.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-calendar"></i>
                            <p>Nenhum agendamento encontrado</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = data.map(booking => `
                    <div class="booking-item">
                        <div class="booking-info">
                            <h4><i class="fas fa-user"></i> ${booking.users?.full_name || 'Cliente'}</h4>
                            <p>
                                <i class="fas fa-cut"></i> ${booking.services?.name} • 
                                <i class="fas fa-calendar"></i> ${new Date(booking.booking_date).toLocaleDateString('pt-BR')} • 
                                <i class="fas fa-clock"></i> ${booking.booking_time.substring(0, 5)} •
                                <i class="fas fa-phone"></i> ${booking.users?.phone || 'Sem telefone'}
                            </p>
                            <p style="margin-top: 5px;">
                                <i class="fas fa-dollar-sign"></i> R$ ${booking.services?.price} • 
                                <i class="fas fa-hourglass-half"></i> ${booking.services?.duration}min
                            </p>
                        </div>
                        <div style="display: flex; gap: 15px; align-items: center;">
                            <span class="booking-status status-${booking.status}">
                                ${booking.status === 'confirmed' ? 'Confirmado' : 
                                  booking.status === 'completed' ? 'Concluído' : 'Cancelado'}
                            </span>
                            <div class="booking-actions">
                                ${booking.status === 'confirmed' ? `
                                    <button class="btn-complete" onclick="updateBookingStatus('${booking.id}', 'completed')">
                                        <i class="fas fa-check"></i> Concluir
                                    </button>
                                    <button class="btn-cancel" onclick="updateBookingStatus('${booking.id}', 'cancelled')">
                                        <i class="fas fa-times"></i> Cancelar
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Erro ao carregar agendamentos:', error);
            }
        }

        // Update Booking Status
        async function updateBookingStatus(bookingId, status) {
            if (!confirm(`Tem certeza que deseja ${status === 'completed' ? 'concluir' : 'cancelar'} este agendamento?`)) {
                return;
            }

            try {
                const { error } = await supabase
                    .from('bookings')
                    .update({ status: status })
                    .eq('id', bookingId);

                if (error) throw error;

                alert('Status atualizado com sucesso!');
                loadBookings();
                loadStats();
            } catch (error) {
                alert('Erro ao atualizar status: ' + error.message);
            }
        }

        // Load Services
        async function loadServices() {
            try {
                const { data, error } = await supabase
                    .from('services')
                    .select('*')
                    .order('id', { ascending: true });

                if (error) throw error;

                const container = document.getElementById('servicesList');

                if (!data || data.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state" style="padding: 20px;">
                            <i class="fas fa-cut"></i>
                            <p>Nenhum serviço cadastrado</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = `
                    <h3 style="margin: 20px 0 15px; color: var(--lime); font-size: 16px;">
                        Serviços Cadastrados
                    </h3>
                    ${data.map(service => `
                        <div class="service-item">
                            <div class="service-info">
                                <h4>${service.name}</h4>
                                <p>R$ ${service.price.toFixed(2)} • ${service.duration} minutos</p>
                            </div>
                            <div class="service-actions">
                                <button class="btn-edit" onclick="editService(${service.id})">
                                    <i class="fas fa-edit"></i> Editar
                                </button>
                                <button class="btn-delete" onclick="deleteService(${service.id})">
                                    <i class="fas fa-trash"></i> Excluir
                                </button>
                            </div>
                        </div>
                    `).join('')}
                `;
            } catch (error) {
                console.error('Erro ao carregar serviços:', error);
            }
        }

        // Add Service
        async function addService() {
            const name = document.getElementById('serviceName').value;
            const price = parseFloat(document.getElementById('servicePrice').value);
            const duration = parseInt(document.getElementById('serviceDuration').value);

            if (!name || !price || !duration) {
                alert('Preencha todos os campos!');
                return;
            }

            try {
                const { error } = await supabase
                    .from('services')
                    .insert([{ name, price, duration }]);

                if (error) throw error;

                alert('Serviço adicionado com sucesso!');
                document.getElementById('serviceName').value = '';
                document.getElementById('servicePrice').value = '';
                document.getElementById('serviceDuration').value = '';
                loadServices();
            } catch (error) {
                alert('Erro ao adicionar serviço: ' + error.message);
            }
        }

        // Edit Service
        async function editService(id) {
            try {
                const { data } = await supabase
                    .from('services')
                    .select('*')
                    .eq('id', id)
                    .single();

                const newName = prompt('Nome do serviço:', data.name);
                if (!newName) return;

                const newPrice = prompt('Preço (R$):', data.price);
                if (!newPrice) return;

                const newDuration = prompt('Duração (minutos):', data.duration);
                if (!newDuration) return;

                const { error } = await supabase
                    .from('services')
                    .update({
                        name: newName,
                        price: parseFloat(newPrice),
                        duration: parseInt(newDuration)
                    })
                    .eq('id', id);

                if (error) throw error;

                alert('Serviço atualizado com sucesso!');
                loadServices();
            } catch (error) {
                alert('Erro ao editar serviço: ' + error.message);
            }
        }

        // Delete Service
        async function deleteService(id) {
            if (!confirm('Tem certeza que deseja excluir este serviço?')) {
                return;
            }

            try {
                const { error } = await supabase
                    .from('services')
                    .delete()
                    .eq('id', id);

                if (error) throw error;

                alert('Serviço excluído com sucesso!');
                loadServices();
            } catch (error) {
                alert('Erro ao excluir serviço: ' + error.message);
            }
        }

        // Schedule Settings
        async function loadScheduleSettings() {
            try {
                const { data } = await supabase
                    .from('settings')
                    .select('*')
                    .in('key', ['working_days', 'open_time', 'close_time', 'interval_time']);

                if (data) {
                    data.forEach(setting => {
                        if (setting.key === 'working_days') {
                            workingDays = JSON.parse(setting.value);
                            updateDayScheduleUI();
                        } else if (setting.key === 'open_time') {
                            document.getElementById('openTime').value = setting.value;
                        } else if (setting.key === 'close_time') {
                            document.getElementById('closeTime').value = setting.value;
                        } else if (setting.key === 'interval_time') {
                            document.getElementById('intervalTime').value = setting.value;
                        }
                    });
                }
            } catch (error) {
                console.error('Erro ao carregar configurações:', error);
            }
        }

        function updateDayScheduleUI() {
            document.querySelectorAll('.day-item').forEach(item => {
                const day = parseInt(item.getAttribute('data-day'));
                if (workingDays.includes(day)) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
        }

        // Toggle working days
        document.querySelectorAll('.day-item').forEach(item => {
            item.addEventListener('click', function() {
                const day = parseInt(this.getAttribute('data-day'));
                const index = workingDays.indexOf(day);
                
                if (index > -1) {
                    workingDays.splice(index, 1);
                    this.classList.remove('active');
                } else {
                    workingDays.push(day);
                    this.classList.add('active');
                }
            });
        });

        // Save Schedule
        async function saveSchedule() {
            const openTime = document.getElementById('openTime').value;
            const closeTime = document.getElementById('closeTime').value;
            const intervalTime = document.getElementById('intervalTime').value;

            try {
                const settings = [
                    { key: 'working_days', value: JSON.stringify(workingDays) },
                    { key: 'open_time', value: openTime },
                    { key: 'close_time', value: closeTime },
                    { key: 'interval_time', value: intervalTime }
                ];

                for (const setting of settings) {
                    await supabase
                        .from('settings')
                        .upsert(setting, { onConflict: 'key' });
                }

                alert('Configurações salvas com sucesso!');
            } catch (error) {
                alert('Erro ao salvar configurações: ' + error.message);
            }
        }

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        // Check if user is already logged in
        supabase.auth.getSession().then(({ data: { session } }) => {
            if (session) {
                currentAdmin = session.user;
                showAdminPanel();
            }
        });

        // Listen for auth changes
        supabase.auth.onAuthStateChange((event, session) => {
            if (event === 'SIGNED_IN' && session) {
                currentAdmin = session.user;
                showAdminPanel();
            } else if (event === 'SIGNED_OUT') {
                logout();
            }
        });
    </script>
</body>
</html>